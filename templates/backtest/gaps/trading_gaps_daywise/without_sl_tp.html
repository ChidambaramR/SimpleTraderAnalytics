{% extends "base.html" %}

{% block content %}
<div class="strategy-description">
    <h2>Trading Gaps Without Stop Loss and Take Profit</h2>
    <p>
        This strategy trades overnight gaps. On a gap up, we will short the stock and on a gap down, 
        we will take a long position. We will not monitor the value of the stock during the day and 
        hence there will be no stop loss and no take profit. We will sell at the end of the day.
    </p>
    <p>
        <strong>Rules:</strong>
        <ul>
            <li>Only trade stocks with absolute gap percentage ≥ 3%</li>
            <li>Gap Up: Short at open, cover at close</li>
            <li>Gap Down: Buy at open, sell at close</li>
            <li>Trade 1 quantity of each stock</li>
            <li>Results shown for both 1L and 10L Investment</li>
        </ul>
    </p>
</div>

<form method="GET" action="{{ url_for('gaps_without_sl_tp') }}" class="mb-4">
    <div class="row g-3">
        <div class="col-md-4">
            <label for="from_date" class="form-label">From Date</label>
            <input type="date" class="form-control" id="from_date" name="from_date" 
                   value="{{ request.args.get('from_date', '') }}" required>
        </div>
        <div class="col-md-4">
            <label for="to_date" class="form-label">To Date</label>
            <input type="date" class="form-control" id="to_date" name="to_date" 
                   value="{{ request.args.get('to_date', '') }}" required>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary me-2">Run Backtest</button>
        </div>
    </div>
</form>

{% if results %}
    {% if 'error' in results %}
    <div class="alert alert-danger" role="alert">
        {{ results.error }}
    </div>
    {% else %}
    <div class="results-section">
        <h3>Backtest Results</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>1L Account</th>
                    <th>10L Account</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Trades</td>
                    <td>{{ results.total_trades }}</td>
                    <td>{{ results.total_trades }}</td>
                </tr>
                <tr>
                    <td>Win Ratio</td>
                    <td>{{ '{:,.2f}'.format(results.win_ratio) }}%</td>
                    <td>{{ '{:,.2f}'.format(results.win_ratio) }}%</td>
                </tr>
                <tr>
                    <td>Initial Capital</td>
                    <td>₹{{ results.initial_capital_1L|indian_currency }}</td>
                    <td>₹{{ results.initial_capital_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Capital Added</td>
                    <td>₹{{ results.capital_added_1L|indian_currency }}</td>
                    <td>₹{{ results.capital_added_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Final Equity</td>
                    <td>₹{{ results.final_capital_1L|indian_currency }}</td>
                    <td>₹{{ results.final_capital_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Profit</td>
                    <td>₹{{ results.profit_1L|indian_currency }}</td>
                    <td>₹{{ results.profit_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Return on Investment</td>
                    <td>{{ '{:,.2f}'.format(results.roi_1L) }}%</td>
                    <td>{{ '{:,.2f}'.format(results.roi_10L) }}%</td>
                </tr>
                <tr>
                    <td>Max Drawdown</td>
                    <td>₹{{ results.max_drawdown_1L|indian_currency }}</td>
                    <td>₹{{ results.max_drawdown_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Average Profit per Trade</td>
                    <td>₹{{ results.avg_profit_per_trade_1L|indian_currency }}</td>
                    <td>₹{{ results.avg_profit_per_trade_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Average Loss per Trade</td>
                    <td>₹{{ results.avg_loss_per_trade_1L|indian_currency }}</td>
                    <td>₹{{ results.avg_loss_per_trade_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Average Daily Profit</td>
                    <td>₹{{ results.avg_daily_profit_1L|indian_currency }}</td>
                    <td>₹{{ results.avg_daily_profit_10L|indian_currency }}</td>
                </tr>
                <tr>
                    <td>Average Daily Loss</td>
                    <td>₹{{ results.avg_daily_loss_1L|indian_currency }}</td>
                    <td>₹{{ results.avg_daily_loss_10L|indian_currency }}</td>
                </tr>
            </tbody>
        </table>
    </div>
    {% endif %}
{% endif %}
{% endblock %} 